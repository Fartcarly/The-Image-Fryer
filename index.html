<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/addons/p5.sound.min.js"></script>
    <title>The Image Fryer

    </title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />

    <style>
    </style>
  </head>
  <body>
    <main>
        <img src="img/The Image Fryer.png" alt="The Image Fryer">
      
      <div class="mainstuff">
        <div class="controls">
          <img src="img/Select Ingredients.png" alt="Select Ingredients">
          <button id="choose-btn" class="choose-btn">
            <img src="img/Choose File.png" class="hvr-grow" alt="Choose File...">
          </button>
          <input type="file" id="file-input" accept="image/*" style="display:none" />
          <button id="take-photo-btn" class="choose-btn">
            <img src="img/Take a photo.png" class="hvr-grow" alt="Take a photo">
          </button>
          <button id="fry-btn" class="choose-btn" style="display:none;margin-top:0.5rem;">
            <img src="img/fry button.png" class="hvr-grow" alt="Fry Button">
          </button>
        </div>
        <div class="fryer-canvas-wrap">
          <img src="img/Big Fryer3.png" alt="Big Fryer" id="big-fryer">
          <button id="reset-image" class="reset-text" style="display:none">[RESET IMAGE]</button>
          <button id="download-image" class="download-text" style="display:none">[DOWNLOAD IMAGE]</button>
        </div>
      </div>
      <!-- Ingredients strip (implemented from Figma assets) -->
      <section class="ingredients">
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Blender" data-filter="1">
            <img class="icon hvr-float" src="img/Object Icons/blender.png" alt="Blender">
          </button>
          <img class="label" src="img/Object Icons/Words_0000_Blender.png" alt="Blender label">
        </figure>
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Coffee" data-filter="2">
            <img class="icon hvr-float" src="img/Object Icons/Coffee.png" alt="Coffee">
          </button>
          <img class="label" src="img/Object Icons/Words_0001_Coffee.png" alt="Coffee label">
        </figure>
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Candle" data-filter="3">
            <img class="icon hvr-float" src="img/Object Icons/candle2.png" alt="Candle">
          </button>
          <img class="label" src="img/Object Icons/Words_0002_Candle.png" alt="Candle label">
        </figure>
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Green blob" data-filter="4">
            <img class="icon hvr-float" src="img/Object Icons/Green Blob.png" alt="Green blob">
          </button>
          <img class="label" src="img/Object Icons/Words_0003_green-Blob.png" alt="Green blob label">
        </figure>
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Mechanism" data-filter="5">
            <img class="icon hvr-float" src="img/Object Icons/Mechanism.png" alt="Mechanism">
          </button>
          <img class="label" src="img/Object Icons/Words_0004_Mechanism.png" alt="Mechanism label">
        </figure>
        <figure class="ingredient">
          <button class="ingredient-btn" aria-label="Fryer" data-filter="0">
            <img class="icon hvr-float" src="img/Object Icons/Image Fryer.png" alt="Small Fryer">
          </button>
          <img class="label" src="img/Object Icons/Words_0005_Fryer.png" alt="Fryer label">
        </figure>
      </section>
    </main>

    <!-- Camera modal / UI -->
    <div id="camera-modal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);z-index:9999;">
      <div style="display:flex;flex-direction:column;gap:0.5rem;align-items:center;">
        <video id="camera-video" autoplay playsinline style="max-width:90vw;max-height:70vh;background:#000;"></video>
        <div style="display:flex;gap:0.5rem;">
          <button id="capture-btn">Capture</button>
          <button id="close-camera-btn">Close</button>
        </div>
      </div>
    </div>
    <canvas id="camera-canvas" style="display:none;"></canvas>
   </body>
   <script src="sketch.js"></script>
   <script>
    (function(){
      const chooseBtn = document.getElementById('choose-btn');
      const fileInput = document.getElementById('file-input');
      const takePhotoBtn = document.getElementById('take-photo-btn');
      const cameraModal = document.getElementById('camera-modal');
      const video = document.getElementById('camera-video');
      const captureBtn = document.getElementById('capture-btn');
      const closeBtn = document.getElementById('close-camera-btn');
      const canvas = document.getElementById('camera-canvas');
      let stream = null;

      const fryBtn = document.getElementById('fry-btn');
      if (chooseBtn && fileInput) {
        chooseBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
          handleFileSelect(e);
          if (fryBtn) fryBtn.style.display = 'block';
        });
      }

      if (takePhotoBtn) {
        takePhotoBtn.addEventListener('click', openCamera);
      }

      captureBtn.addEventListener('click', capturePhoto);
      closeBtn.addEventListener('click', closeCamera);

      function handleFileSelect(e){
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        if (typeof window.handleFile === 'function') window.handleFile(file);
        else console.log('Selected file:', file.name);
      }

      function openCamera(){
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
          .then(s => {
            stream = s;
            video.srcObject = stream;
            cameraModal.style.display = 'flex';
            video.play();
          })
          .catch(err => {
            console.error('Camera error', err);
            alert('Unable to access camera.');
          });
      }

      function capturePhoto(){
        if (!video.videoWidth || !video.videoHeight) return;
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        // flip horizontally to mirror the webcam video
        ctx.scale(-1, 1);
        ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
        canvas.toBlob(blob => {
          if (!blob) return;
          const file = new File([blob], 'webcam.jpg', { type: blob.type });
          if (typeof window.handleFile === 'function') window.handleFile(file);
          else console.log('Captured photo:', file);
          if (fryBtn) fryBtn.style.display = 'block';
        }, 'image/jpeg', 0.95);
        closeCamera();
      }

      function closeCamera(){
        cameraModal.style.display = 'none';
        if (stream) {
          stream.getTracks().forEach(t => t.stop());
          stream = null;
        }
        video.srcObject = null;
      }

      // set global filterType when ingredient buttons are clicked
      const ingredientBtns = document.querySelectorAll('.ingredient-btn');
      ingredientBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const f = btn.getAttribute('data-filter');
          if (f !== null) {
            window.filterType = parseInt(f, 10);
            console.log('filterType =', window.filterType);
            // add red glow to selected button, remove from others
            ingredientBtns.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            if (typeof window.replaceWithIcon === 'function') {
              window.replaceWithIcon(window.filterType);
            }
          }
        });
      });

      // fry button: apply filter effects to the canvas image
      if (fryBtn) {
        fryBtn.addEventListener('click', () => {
          if (typeof window.applyFry === 'function') {
            window.applyFry();
          } else {
            console.log('applyFry function not available yet');
          }
        });
        // shrink while pressed (mouse/touch)
        fryBtn.addEventListener('mousedown', () => fryBtn.classList.add('pressed'));
        fryBtn.addEventListener('mouseup', () => fryBtn.classList.remove('pressed'));
        fryBtn.addEventListener('mouseleave', () => fryBtn.classList.remove('pressed'));
        fryBtn.addEventListener('touchstart', () => fryBtn.classList.add('pressed'));
        fryBtn.addEventListener('touchend', () => fryBtn.classList.remove('pressed'));
      }
      const resetBtn = document.getElementById('reset-image');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          if (typeof window.resetToOriginal === 'function') window.resetToOriginal();
        });
      }
      const downloadBtn = document.getElementById('download-image');
      if (downloadBtn) {
        downloadBtn.addEventListener('click', () => {
          if (typeof window.downloadImage === 'function') window.downloadImage();
        });
      }
    })();
   </script>
 </html>
